"use client";

import React, { useState, useEffect, useRef } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import { cn } from '@/lib/utils';
import Link from 'next/link';

const StatCounter = ({ to, prefix, suffix, isVisible }: { to: number; prefix?: string; suffix: string; isVisible: boolean }) => {
  const [count, setCount] = useState(0);

  useEffect(() => {
    if (isVisible) {
      const duration = 2000;
      const stepTime = Math.abs(Math.floor(duration / to));
      const timer = setInterval(() => {
        setCount(prevCount => {
          if (prevCount < to) {
            return prevCount + 1;
          } else {
            clearInterval(timer);
            return to;
          }
        });
      }, stepTime);
      return () => clearInterval(timer);
    }
  }, [to, isVisible]);

  return <span className="text-5xl font-bold text-accent">{prefix}{count}{suffix}</span>;
};

const Hero = () => {
  const statsRef = useRef<HTMLDivElement>(null);
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsVisible(true);
          observer.unobserve(entry.target);
        }
      },
      { threshold: 0.5 }
    );
    if (statsRef.current) {
      observer.observe(statsRef.current);
    }
    return () => observer.disconnect();
  }, []);

  return (
    <section id="accueil" className="relative bg-gradient-to-br from-secondary to-slate-800 text-white overflow-hidden">
      <div className="absolute inset-0 bg-[radial-gradient(circle_at_20%_50%,_rgba(59,130,246,0.1)_0%,_transparent_50%),radial-gradient(circle_at_80%_80%,_rgba(245,158,11,0.05)_0%,_transparent_50%)] opacity-50"></div>
      <div className="container mx-auto px-6 pt-40 pb-28 sm:pt-48 sm:pb-32 relative z-10">
        <div className="grid lg:grid-cols-2 gap-16 items-center">
          <div className="animate-fade-in-up">
            <h1 className="text-4xl md:text-5xl lg:text-6xl font-extrabold !leading-tight tracking-tight">
              Transformez vos <span className="text-gradient bg-gradient-to-r from-primary to-accent">biens complexes</span> en actifs rentables
            </h1>
            <p className="mt-6 text-lg md:text-xl text-primary-foreground/80 max-w-2xl">
              Expert en valorisation de patrimoine locatif : biens vacants, passoires √©nerg√©tiques, succession, impay√©s... Nous pilotons votre patrimoine pour maximiser sa performance.
            </p>
            <div className="mt-10">
              <Button asChild size="lg" className="rounded-full font-bold text-base px-8 py-7 shadow-lg hover:shadow-primary/40 transition-shadow duration-300 transform hover:-translate-y-1">
                <Link href="#contact">Diagnostic Gratuit</Link>
              </Button>
            </div>
            <div ref={statsRef} className="mt-12 flex flex-col sm:flex-row gap-8 sm:gap-12">
              <div className="text-center">
                <StatCounter to={50} prefix="+" suffix="" isVisible={isVisible} />
                <span className="block text-sm text-primary-foreground/70 mt-1">Biens pilot√©s</span>
              </div>
              <div className="text-center">
                <StatCounter to={20} prefix="+" suffix="%" isVisible={isVisible} />
                <span className="block text-sm text-primary-foreground/70 mt-1">Rentabilit√© augment√©e</span>
              </div>
              <div className="text-center">
                <StatCounter to={100} suffix="%" isVisible={isVisible} />
                <span className="block text-sm text-primary-foreground/70 mt-1">Gestion d√©l√©gu√©e</span>
              </div>
            </div>
          </div>
          <div className="relative h-96 hidden lg:block animate-fade-in">
            <Card className="absolute top-0 left-0 bg-white/10 backdrop-blur-lg border-white/20 text-white p-6 rounded-2xl w-64 animate-float [animation-delay:-2s]">
              <CardContent className="p-0">
                <p className="font-bold text-lg">üèöÔ∏è Bien vacant</p>
                <p className="text-sm text-white/80">‚Üí Relou√© en 45j</p>
              </CardContent>
            </Card>
            <Card className="absolute top-28 right-12 bg-white/10 backdrop-blur-lg border-white/20 text-white p-6 rounded-2xl w-64 animate-float [animation-delay:0s]">
              <CardContent className="p-0">
                <p className="font-bold text-lg">‚ö° DPE G</p>
                <p className="text-sm text-white/80">‚Üí R√©nov√© en C</p>
              </CardContent>
            </Card>
            <Card className="absolute bottom-12 left-24 bg-white/10 backdrop-blur-lg border-white/20 text-white p-6 rounded-2xl w-64 animate-float [animation-delay:-4s]">
              <CardContent className="p-0">
                <p className="font-bold text-lg">üí∞ Charges -40%</p>
                <p className="text-sm text-white/80">‚Üí Rentabilit√© +25%</p>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </section>
  );
};

export default Hero;
